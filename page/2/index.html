<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"keepalive555.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="枫叶居">
<meta property="og:url" content="https://keepalive555.github.io/page/2/index.html">
<meta property="og:site_name" content="枫叶居">
<meta property="og:description" content="技术博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lan Wei, Wang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://keepalive555.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>枫叶居</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫叶居</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">桃李春风一杯酒，江湖夜雨十年灯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/baidusitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/07/31/MySQL%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/31/MySQL%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">MySQL前缀索引</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-07-31 22:42:18" itemprop="dateCreated datePublished" datetime="2017-07-31T22:42:18+08:00">2017-07-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-24 00:54:36" itemprop="dateModified" datetime="2020-09-24T00:54:36+08:00">2020-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2><span id="mysql前缀索引">MySQL前缀索引</span></h2><p><strong>注意：</strong> 本文的所有优化仅针对InnoDB存储引擎。</p>
<p>MySQL索引可以加快查询速度，但是索引并不是越多越好，索引虽然可以加快数据的查询速度，但是索引文件本身需要占用存储空间，数据的插入，删除，和修改也需要索引保持同步，据一线有经验的DBA介绍，索引列占表所有列的30%是比较合理的。</p>
<h4><span id="查看表存在的索引">查看表存在的索引</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> <span class="string">`table`</span>;</span><br></pre></td></tr></table></figure>
<h4><span id="查看索引占用磁盘空间大小">查看索引占用磁盘空间大小</span></h4><blockquote>
<p>MySQL<code>information_schema</code>数据库<code>TABLES</code>表<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/tables-table.html">官方手册</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">round</span>(<span class="keyword">sum</span>(INDEX_LENGTH/(<span class="number">1024</span>*<span class="number">1024</span>)), <span class="number">2</span>), <span class="string">&#x27;MB&#x27;</span>) <span class="keyword">as</span> <span class="string">&#x27;Total Index Size&#x27;</span> <span class="keyword">from</span> <span class="string">`information_schema`</span>.<span class="string">`TABLES`</span> <span class="keyword">where</span> <span class="string">`table_schema`</span> = <span class="string">&#x27;order&#x27;</span> <span class="keyword">and</span> <span class="string">`table_name`</span> = <span class="string">&#x27;order_base&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 以下两种情况，不建议建立索引。</p>
<ul>
<li>表记录数比较少 —— InnoDB辅助索引叶子节点存储的不是记录的物理地址，而是主键值，使用辅助索引查找数据总是需要第二次查找主键索引，在表记录较少的情况下，建立索引反而会降低查询性能，所以直接全表扫描就好了，具体基准需根据业务场景而定。</li>
<li>索引的选择性比较低 —— 索引的选择性指不重复的索引值与表记录数的比值，值域为(0, 1]。索引选择性越高越好，可以通俗的理解为，选择性高的索引在查询时往往可以筛选出比较多的记录，所以访问表的次数较少，索引的有效率比较高。例如存在基本表<code>table</code>，我们要在表<code>table</code>的<code>column</code>列上建立一个索引，我们使用如下<code>SQL</code>语句计算该索引的选择性：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> <span class="string">`column`</span>) / <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="string">`table`</span>;</span><br></pre></td></tr></table></figure>

<h4><span id="前缀索引">前缀索引</span></h4><p>前缀索引是一种与索引选择性相关联的索引优化技术，顾名思义，使用列的前缀代替整个列作为Key，当前缀长度合理时，既可以做到前缀索引的选择性接近全列索引，同时因为索引Key变短而减少索引文件的大小和维护开销。</p>
<p>想象一下存在如下业务场景，一张存放订单信息的基本表<code>order</code>，订单号长度为24位（如：61700123215824），表结构如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>order_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>61700123215824</td>
</tr>
<tr>
<td>2</td>
<td>61500280698102</td>
</tr>
<tr>
<td>3</td>
<td>61500280756582</td>
</tr>
</tbody></table>
<p>首先计算一下，全列索引选择性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="keyword">count</span>(<span class="keyword">distinct</span> <span class="string">`order_id`</span>) / <span class="keyword">count</span>(*), <span class="number">2</span>) <span class="keyword">from</span> <span class="string">`order`</span>;</span><br></pre></td></tr></table></figure>
<p>结果为1.00，选择前缀长度为5，看一下索引的选择性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="keyword">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(<span class="string">`order_id`</span>, <span class="number">5</span>)) / <span class="keyword">count</span>(*), <span class="number">2</span>) <span class="keyword">from</span> <span class="string">`order`</span>;</span><br></pre></td></tr></table></figure>
<p>结果为0.00，5个字符长度的前缀，看来不行，我们增加到10，看一下索引的选择性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="keyword">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(<span class="string">`order_id`</span>, <span class="number">10</span>)) / <span class="keyword">count</span>(*), <span class="number">2</span>) <span class="keyword">from</span> <span class="string">`order`</span>;</span><br></pre></td></tr></table></figure>
<p>结果为0.63，差强人意，我们继续以5位单位递增，看一下索引的选择性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="keyword">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(<span class="string">`order_id`</span>, <span class="number">15</span>)) / <span class="keyword">count</span>(*), <span class="number">2</span>) <span class="keyword">from</span> <span class="string">`order`</span>;</span><br></pre></td></tr></table></figure>
<p>由于round的四舍五入，结果为1.00，那前缀能不能更少一些，在公司的业务系统内试了一下，前缀长度为11时，索引选择性为0.9999，四舍五入为1。通过夹逼的方法（😆默默的想起高数的夹逼定理），找到了最佳的索引前缀长度为11，接下来我们创建前缀索引：</p>
<blockquote>
<p>创建前缀索引</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`order`</span> <span class="keyword">add</span> <span class="keyword">index</span> <span class="string">`idx_order_id`</span>(<span class="string">`order_id`</span>(<span class="number">11</span>));</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 前缀索引的缺点</p>
<ul>
<li>前缀索引不能用于order by与group by操作。</li>
<li>前缀索引不能用于covering index —— 显而易见，前缀索引并未包含<code>order_id</code>列的全部信息，所以并不能用于covering index。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/07/06/%E9%AB%98%E6%95%88%E7%8E%87Shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/06/%E9%AB%98%E6%95%88%E7%8E%87Shell/" class="post-title-link" itemprop="url">高效率Shell</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-07-06 13:52:12" itemprop="dateCreated datePublished" datetime="2017-07-06T13:52:12+08:00">2017-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-08-05 16:12:57" itemprop="dateModified" datetime="2017-08-05T16:12:57+08:00">2017-08-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bash/" itemprop="url" rel="index"><span itemprop="name">Bash</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bash/Shell/" itemprop="url" rel="index"><span itemprop="name">Shell</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>快速将开发分支代码合并至测试分支。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DEV=dev</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">merge_dev</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="variable">$&#123;DEV&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ -z <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">            DEV=<span class="string">&quot;dev&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            DEV=<span class="variable">$1</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    BRANCH=$(git rev-parse --abbrev-ref HEAD)</span><br><span class="line">    git push origin <span class="variable">$&#123;BRANCH&#125;</span></span><br><span class="line">    git checkout <span class="variable">$&#123;DEV&#125;</span> \</span><br><span class="line">        &amp;&amp; git pull origin <span class="variable">$&#123;DEV&#125;</span> \</span><br><span class="line">        &amp;&amp; git merge <span class="variable">$&#123;BRANCH&#125;</span> -m <span class="string">&quot;merge code automatically&quot;</span> \</span><br><span class="line">        &amp;&amp; git push origin <span class="variable">$&#123;DEV&#125;</span> \</span><br><span class="line">        &amp;&amp; git checkout <span class="variable">$&#123;BRANCH&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>统计工程代码行数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./ -name <span class="string">&quot;*.py&quot;</span> -<span class="built_in">exec</span> wc -l &#123;&#125; \;|awk <span class="string">&#x27;BEGIN&#123;total=0&#125;&#123;print $1&quot;\t&quot;$2; $total+=$1&#125;END&#123;print &quot;total lines: &quot;$total&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>显示代码行最多的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./ -name <span class="string">&quot;*.py&quot;</span> | xargs -n 1 wc -l|sort -nr</span><br></pre></td></tr></table></figure>

<p>显示处于<code>TIME_WAIT</code>的<code>SOCKET</code>个数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -n|awk <span class="string">&#x27;/^tcp/&#123;a[$6]++&#125;END&#123;for (j in a) print a[j], j&#125;&#x27;</span>|sort -nr|head -n 10</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/04/15/%E9%AB%98%E6%95%88%E7%8E%87Bash-Shell%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/15/%E9%AB%98%E6%95%88%E7%8E%87Bash-Shell%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">高效率Bash Shell快捷键</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-15 00:47:59" itemprop="dateCreated datePublished" datetime="2017-04-15T00:47:59+08:00">2017-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-07-06 18:20:58" itemprop="dateModified" datetime="2017-07-06T18:20:58+08:00">2017-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Shell/" itemprop="url" rel="index"><span itemprop="name">Shell</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Shell/Bash/" itemprop="url" rel="index"><span itemprop="name">Bash</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2><span id="简介">简介</span></h2><p><a href="https://keepalive555.github.io/2017/04/15/%E9%AB%98%E6%95%88%E7%8E%87Bash-Shell%E5%BF%AB%E6%8D%B7%E9%94%AE/"><em>转载说明：本文章为作者原创，转载请标注原文地址</em></a></p>
<p>Bash Shell快捷键默认为Emacs编辑模式，与Emacs编辑器快捷键兼容，可通过<code>set -o vi</code>切换至vi编辑模式，通过<code>set -o emacs</code>切换回默认的Emacs编辑模式，本文所列快捷键均为Emacs模式下快捷键。</p>
<h5><span id="特别注意"><em>特别注意：</em></span></h5><blockquote>
<p>本人工作中一直使用Emacs编辑模式，Emacs编辑模式下的Alt键默认非Meta键（Emacs中使用频率很高的组合键），需要在终端中打开该项设置。</p>
</blockquote>
<h3><span id="1移动命令">1.移动命令</span></h3><ul>
<li>Ctrl + a: 移动到命令行行首</li>
<li>Ctrl + e: 移动到命令行行尾</li>
<li>Ctrl + f: 向前移动一个字符</li>
<li>Ctrl + b: 向后移动一个字符</li>
<li>Alt + f: 向前移动一个单词</li>
<li>Alt + b: 向后移动一个单词</li>
</ul>
<h3><span id="2删除命令">2.删除命令</span></h3><ul>
<li>Ctrl + u: 删除命令行行首至光标处的所有字符</li>
<li>Ctrl + k: 删除光标处至命令行行尾的所有字符</li>
<li>Ctrl + d: 删除光标处的字符</li>
<li>Ctrl + h: 删除光标前的字符</li>
<li>Ctrl + w: 删除光标处至单词词首的所有字符</li>
<li>Alt + d: 删除光标处至单词词尾的所有字符</li>
</ul>
<h3><span id="3编辑命令">3.编辑命令</span></h3><ul>
<li>Ctrl + y: 粘贴至光标后</li>
<li>Ctrl + x Ctrl + u： 撤销上次编辑操作</li>
<li>Ctrl + x Ctrl + e: 启动编辑器编辑命令（<strong>注：可编辑字符较多的命令</strong>)</li>
</ul>
<h3><span id="4搜索历史命令">4.搜索历史命令</span></h3><ul>
<li>Ctrl + r: 向后搜索历史命令（<strong>注：Ctrl + r可按多次，向后搜索历史命令</strong>）</li>
<li>Ctrl + g: 退出搜索模式</li>
<li>Ctrl + p: 上一条命令</li>
<li>Ctrl + n: 下一条命令</li>
</ul>
<h3><span id="5控制命令">5.控制命令</span></h3><ul>
<li>Ctrl + l: 清屏（<strong>注：相当于clear命令</strong>)</li>
<li>Ctrl + c: 终止命令</li>
<li>Ctrl + z: 挂起命令</li>
</ul>
<h3><span id="6命令">6.!命令</span></h3><ul>
<li>!!: 执行上一条命令（<strong>注：执行$ls，后执行$!!，则会执行$ls</strong>）</li>
<li>!<prefix>: 执行最近执行的以<prefix>开头的命令</prefix></prefix></li>
</ul>
<h3><span id="参考文档">参考文档</span></h3><p>[1]: <a target="_blank" rel="noopener" href="https://www.gnu.org/software/bash/manual/bash.html#Command-Line-Editing">Bash官方手册</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/04/04/MySQL%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/04/MySQL%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">MySQL笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-04 14:24:23" itemprop="dateCreated datePublished" datetime="2017-04-04T14:24:23+08:00">2017-04-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-24 00:54:20" itemprop="dateModified" datetime="2020-09-24T00:54:20+08:00">2020-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%innodb_old_blocks_pct%&#x27;</span>; <span class="comment">-- 37%</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%innodb_buffer_pool_size%&#x27;</span>; <span class="comment">-- 显示InnoDB存储引擎BufferPool大小，134217728 = 128Mb</span></span><br><span class="line"><span class="comment">-- 热点数据</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%innodb_old_blocks_time%&#x27;</span>; <span class="comment">-- 1000ms, 位于midpoint处的数据在等待多长时间之后才会放入new热点数据。</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engine</span> <span class="keyword">innodb</span> <span class="keyword">status</span>; <span class="comment">-- 显示innodb引擎的状态</span></span><br><span class="line"><span class="comment">-- Modified db pages 指的是Flush list里面的DirtyPage</span></span><br><span class="line"><span class="comment">-- buffer pool hit rate</span></span><br><span class="line"><span class="keyword">select</span> pool_id, hit_rate, pages_made_young <span class="keyword">from</span> <span class="string">`information_schema`</span>.nnodb_buffer_pool_stats; <span class="comment">--</span></span><br><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`information_schema`</span>.innodb_buffer_page_lru; <span class="comment">-- 查看innodb BufferPool中LRU list中具体Page信息。  </span></span><br><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`information_schema`</span>.innodb_buffer_page_lru <span class="keyword">where</span> oldest_modification &gt; <span class="number">0</span>; <span class="comment">-- 查看DirtyPage</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%innodb_log_buffer_size%&#x27;</span>; <span class="comment">-- redo log buffer大小，默认为8MB，该缓冲区不需要太大，因为会被刷新至日志文件。   </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%innodb_fast_shutdown%&#x27;</span>; <span class="comment">-- SharpCheckpoint在Database关闭时将所有DirtyPage Flush回Disk，这是默认的工作方式。</span></span><br><span class="line"><span class="comment">-- FuzzyCheckpoint 进行部分页的刷新</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engine</span> <span class="keyword">innodb</span> <span class="keyword">status</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;datadir&#x27;</span>; <span class="comment">-- datadir代表数据库所在目录</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span>; <span class="comment">-- 显示master节点信息</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;binlog_cache_size&#x27;</span>; <span class="comment">-- binlo_cache_size mysql会为每一个Session开启一个binlog_cache，默认为32kB大小。</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">&#x27;binlog_cache%&#x27;</span>; <span class="comment">-- Binlog_cache_use -&gt; 缓存使用次数，Binlog_cache_disk_use -&gt; 磁盘使用次数。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;sync_binlog&#x27;</span>; <span class="comment">-- 二进制日志并不是在每次写的时候同步到磁盘（用户可以理解为缓冲写），因此数据所在操作系统挂机时，可能会有一部分数据没有写入二进制文件</span></span><br><span class="line"><span class="comment">-- sync_binlog = [N]，表示每写多少次就同步至磁盘sync_binlog = 1表示采用同步写磁盘的方式来写二进制日志。</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_support_xa&#x27;</span>; <span class="comment">-- 让mysql支持xa事务</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>; <span class="comment">-- 指定binlog格式</span></span><br><span class="line"><span class="keyword">set</span> @@session.binlog_format = <span class="string">&#x27;ROW&#x27;</span>; <span class="comment">-- 修改会话级别binlog_format</span></span><br><span class="line"><span class="keyword">select</span> @@session.binlog_format; <span class="comment">-- ROW</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;socket&#x27;</span>; <span class="comment">-- mysqld监听的unix socket文件</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;pid_file&#x27;</span>; <span class="comment">-- mysqld的pid文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_data_file_path&#x27;</span>; <span class="comment">-- ibdata1:12M:autoextend 格式innodb_data_file_path=datafile_spec1[; datafile_spec2]...</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_file_per_table&#x27;</span>; <span class="comment">-- 为每个基于innodb存储引擎的表产生一个独立的表空间，命名规则为：</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- innodb默认ib_logfile0, ib_logfile1是重做日志（redo log file）</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_log_file_size&#x27;</span>; <span class="comment">-- innodb redo log file size默认为512GB</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_log_files_in_group&#x27;</span>; <span class="comment">-- redo log group日志文件数量</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_log_group_home_dir&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_mirrored_log_groups&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;innodb_flush_log_at_trx_commit&#x27;</span>; <span class="comment">-- 有效值为：0，1，2。0  - 当提交事务时，并不将事务的重做日志写入磁盘上的日志文件，而是等待主线程每秒的刷新。</span></span><br><span class="line"><span class="comment">-- 1 - 表示在执行commit时将重做日志缓冲同步写到磁盘，即伴有fsync的调用， 2 - 表示将重做日志写入磁盘，即写到文件系统的缓存中。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%partition%&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> plugins;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysql数据库支持以下几种类型的分区。range分区，list分区，hash分区，key分区。</span></span><br><span class="line"><span class="comment">-- range分区：行数据基于属于一个给定连续区间的列值被放入分区。</span></span><br><span class="line"><span class="comment">-- list</span></span><br><span class="line"><span class="comment">-- hash</span></span><br><span class="line"><span class="comment">-- key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- innodb_file_pe_table</span></span><br><span class="line"><span class="comment">-- 表空间</span></span><br><span class="line"><span class="comment">-- ①数据②索引③插入缓冲Bitmap页</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- system ls /;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/04/01/Thrift%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/01/Thrift%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Thrift教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-01 00:21:27" itemprop="dateCreated datePublished" datetime="2017-04-01T00:21:27+08:00">2017-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-24 00:51:41" itemprop="dateModified" datetime="2020-09-24T00:51:41+08:00">2020-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RPC/" itemprop="url" rel="index"><span itemprop="name">RPC</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RPC/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2><span id="1thrift简介">1.Thrift简介</span></h2><p><a href="https://keepalive555.github.io/2017/04/01/Thrift%E6%95%99%E7%A8%8B/"><em>转载说明：本文章为作者原创，转载请标注原文地址</em></a></p>
<p>Thrift由Facebook开发，解决了由不同语言编写的服务之间的调用问题。2009年Facebook将Thrift贡献给Apache基金会，成为一个开源项目。Thrift为典型的C/S架构，采用IDL(Interface Description Language)，定义接口。</p>
<p>Thrift提供了命令行工具thrift，根据指定的IDL定义文件，生成不同语言的代码。因Thrift的依赖比较多，所以建议读者，采用自己开发平台的包管理工具进行安装。本人平时在macOS下进行开发工作，采用brew install thrift，便可自动完成了thrift的安装。</p>
<h2><span id="2thrift-idl介绍">2.Thrift IDL介绍</span></h2><p>Thrift IDL的语法比较接近C++，熟悉C++的读者，可以迅速掌握Thrift IDL的语法。由于IDL语法上比较接近C++，所以Thrift IDL比较偏向于静态语言，Python、Ruby等动态语言开发者在使用IDL定义接口时需要特别注意。</p>
<p>Thrift IDL支持C/C++风格的“//”，“/*，*/”注释，也支持Python风格的”#”注释。</p>
<h3><span id="1基本数据类型">1.基本数据类型</span></h3><ul>
<li>bool: A boolean value, true or false（<strong>注：布尔值</strong>)</li>
<li>byte: A signed byte（<strong>注：有符号字节</strong>）</li>
<li>i16: A 16-bit signed integer（<strong>注：16位有符号数</strong>）</li>
<li>i32: A 32-bit signed integer（<strong>注：32位有符号数</strong>）</li>
<li>i64: A 64-bit signed integer（<strong>注：64位有符号数</strong>）</li>
<li>double: A 64-bit floating point number（<strong>注：64位浮点数</strong>）</li>
<li>string: An encoding-agnostic text or binary string(<strong>注：编码无关的字符串</strong>）</li>
<li>void: Void (<strong>注：无返回值</strong>）</li>
</ul>
<h3><span id="2复合类型">2.复合类型</span></h3><h4><span id="1struct">1.struct</span></h4><p>struct——结构体类型，类似于C/C++中的结构体类型，将不同类型的数据聚合到一块儿。（<strong>注：描述面向对象语言中的类</strong>)。</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="number">1</span>: <span class="built_in">i32</span> id,</span><br><span class="line">	<span class="number">2</span>: <span class="built_in">string</span> user_name,</span><br><span class="line">	<span class="number">3</span>: <span class="keyword">required</span> <span class="built_in">bool</span> is_admin,</span><br><span class="line">	<span class="number">4</span>: <span class="keyword">optional</span> <span class="built_in">string</span> nick_name,</span><br><span class="line">	<span class="number">5</span>: <span class="keyword">optional</span> <span class="built_in">string</span> sex = <span class="string">&quot;male&quot;</span>,</span><br><span class="line">	<span class="number">20</span>: <span class="keyword">optional</span> <span class="built_in">string</span> city,</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> </p>
<ol>
<li>optional关键字标识该字段为可选的。</li>
<li>required关键字标识该字段为必填的。</li>
<li>定义中的序号，不可重复，但不是必须连续的。</li>
</ol>
<h4><span id="2enum">2.enum</span></h4><p>enum枚举类型</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">UserType</span> </span>&#123;</span><br><span class="line">	BLOCKED = <span class="number">0</span>,</span><br><span class="line">	NORMAL = <span class="number">1</span>,</span><br><span class="line">	ADMIN = <span class="number">2</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="3容器类型">3.容器类型</span></h3><p>容器类型比较类似于C++ STL中的容器类型，Thrift提供了三种容器类型：list，map，set。</p>
<ul>
<li>list&lt;T&gt;: 由元素T组成的有序列表，Thrift将该容器类型编译为，C++ STL中的vector，Java中ArrayList，Python中list等等…</li>
<li>set&lt;T&gt;: 无序的集合，Thrift将该容器类型编译为，C++ STL中的set，Java中的HashSet，Python中set等等…</li>
<li>map&lt;T1, T2&gt;: k-v映射，Thrift将该容器类型编译为，C++ STL中的map，Java中的HashMap，Python中的dict等等…</li>
</ul>
<h3><span id="4自定义类型">4.自定义类型</span></h3><p>Thrift支持C/C++风格的，typedef关键字，用于声明自定义类型。</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">i32</span> Integer</span><br></pre></td></tr></table></figure>

<h3><span id="5异常">5.异常</span></h3><p>Thrift支持自定义异常，语法同struct类型的定义相似，如下所示：</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">exception</span> <span class="title">NotFound</span> </span>&#123;</span><br><span class="line">	<span class="number">1</span>: <span class="built_in">string</span> message,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注：在编写服务端代码时，仅仅在代码中抛出异常，是不够的，需要在定义接口时，指明该接口可能抛出的异常</strong></p>
<h3><span id="6服务">6.服务</span></h3><p>Thrift IDL中的Service，与Java中的Interface有异曲同工之妙。Thrift定义服务的语法如下：</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">service</span> &lt;<span class="title">name</span>&gt; </span>&#123;</span><br><span class="line">	&lt;returntype&gt; &lt;name&gt;(&lt;arguments&gt;)</span><br><span class="line">	[throws (&lt;exceptions&gt;)]</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义一个获取用户的Service示例如下：</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	User query_user(<span class="number">1</span>: <span class="built_in">i32</span> user_id) throws (</span><br><span class="line">		<span class="number">1</span>: NotFound not_found),</span><br><span class="line">	User add_user(<span class="number">1</span>: User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：service中接口定义之间的分割符号，可以是”，“，也可以是”；“。</strong></p>
<h3><span id="7命名空间">7.命名空间</span></h3><p>Thrift支持C++风格的命明空间，等同于Java、Python中的package的概念。Thrift定义命名空间的语法如下：</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> cpp com.example.project</span><br><span class="line"><span class="keyword">namespace</span> java com.example.project</span><br><span class="line"><span class="keyword">namespace</span> py com.example.project</span><br></pre></td></tr></table></figure>


<h2><span id="3thrift使用方法">3.Thrift使用方法</span></h2><p>示例文件：</p>
<figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filename: user.thrift</span></span><br><span class="line"><span class="keyword">namespace</span> py thrift.rpc.user</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Sex</span> </span>&#123;</span><br><span class="line">	FEMALE = <span class="number">0</span>,</span><br><span class="line">	MALE = <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="number">1</span>: <span class="built_in">string</span> user_name,</span><br><span class="line">	<span class="number">2</span>: Sex sex,</span><br><span class="line">	<span class="number">3</span>: <span class="keyword">required</span> <span class="built_in">i32</span> age,</span><br><span class="line">	<span class="number">4</span>: <span class="keyword">optional</span> <span class="built_in">string</span> city,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">exception</span> <span class="title">NotFound</span> </span>&#123;</span><br><span class="line">	<span class="number">1</span>: <span class="built_in">string</span> message,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	User query_user(<span class="number">1</span>: <span class="built_in">i32</span> id) throws (</span><br><span class="line">		<span class="number">1</span>: NotFound not_found),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Shell里面输入如下命令，生成Python代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thrift -out py --gen py:new_style,utf8strings,coding=utf-8</span><br></pre></td></tr></table></figure>

<p>--gen参数，指定待目标语言，冒号后以都好分割的为thrift为该语言提供的选项。</p>
<p>-out参数，指定thrift生成代码的存放路径（**注：仅有一个-**）</p>
<p>更详细的用法，可通过<code>thrift --help</code>获取。</p>
<h2><span id="参考资料">参考资料</span></h2><p>[1]<a target="_blank" rel="noopener" href="https://thrift.apache.org/static/files/thrift-20070401.pdf">Thrift官方手册</a></p>
<p>[2]<a target="_blank" rel="noopener" href="https://diwakergupta.github.io/thrift-missing-guide/">Thrift:The Missing Guide</a></p>
<p>[3]<a target="_blank" rel="noopener" href="https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob_plain;f=tutorial/tutorial.thrift">Thrift官方示例</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/03/29/MySQL%E5%88%86%E9%A1%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/29/MySQL%E5%88%86%E9%A1%B5/" class="post-title-link" itemprop="url">MySQL分页</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-29 22:49:42" itemprop="dateCreated datePublished" datetime="2017-03-29T22:49:42+08:00">2017-03-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-24 00:54:10" itemprop="dateModified" datetime="2020-09-24T00:54:10+08:00">2020-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="http://keepalive555.github.io/2017/03/29/MySQL%E5%88%86%E9%A1%B5/"><em>转载说明：本文章为作者原创，转载请标注原文地址</em></a></p>
<p>公司最近上线了“订单管理系统”，系统内有比较多的分页展示逻辑，所以我单独拿出了点时间，对MySQL的分页做了总结。</p>
<p>提到MySQL分页，我们通常会首先考虑，使用偏移量offset+limit的办法实现。下面以实现目标：<br><strong>查询订单表<code>order</code>，并按订单创建时间<code>create_time</code>，降序排序，每页<code>50</code>条记录</strong><br>，为例进行说明。首先我们想到的sql语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`create_time`</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">0</span>, <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
<p>多次执行该操作，随着页数增加（<em>即：偏移量增大</em>），该查询语句的性能随之下降，耗时比较明显。当并发量上来时，这对MySQL数据库的压力是致命的。以翻页至200页为例，MySQL会查询<code>200 * 50</code>条记录，最后只返回<code>50</code>条记录，前面的<code>200 * (50 - 1)</code>条记录，将会被丢弃。</p>
<p>因为订单的属性很多，所以并无法为每一列建立索引（当然为每一列都建立索引，是简单粗暴的）。优化此类分页查询的一个最简单的办法，尽可能使用索引覆盖扫描，而不是查询所有列，然后在关联返回所需要的列。优化后的SQL语句如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">inner</span> <span class="keyword">join</span> (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`create_time`</span> <span class="keyword">limit</span> <span class="keyword">desc</span> <span class="number">10000</span>, <span class="number">50</span>) <span class="keyword">as</span> <span class="string">`tmp`</span> <span class="keyword">using</span>(<span class="string">`id);</span></span><br></pre></td></tr></table></figure>

<p>这里MySQL扫描了尽可能少的页面，获取需要访问的记录后，然后再去关联查询，获取了所需的列，该种用法还存在若干类似的变种。</p>
<p>最后，也是我们确定的技术选型。推荐的用法，前端每次查询都传入上次查询记录的max_id，或者min_id传递给我们，然后根据id的索引去优化该操作。（<strong>注：只有id列的单调性与目标列的单调性一致时可采用该方案</strong>）产品设计上，我们不返回具体的页数，只提供了当前页，前后10页跳页的功能，解决了该问题。</p>
<p>向后翻页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`create_time`</span> <span class="keyword">desc</span> <span class="keyword">where</span> <span class="string">`id`</span> &lt; min_id <span class="keyword">limit</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>向前跳页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`create_time`</span> <span class="keyword">desc</span> <span class="keyword">where</span></span><br><span class="line"><span class="string">`id`</span> &lt; min_id <span class="keyword">limit</span> <span class="number">450</span>, <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>向前翻页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`create_time`</span> <span class="keyword">desc</span> <span class="keyword">where</span> <span class="string">`id`</span> &gt; max_id <span class="keyword">limit</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>向后跳页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> <span class="string">`order`</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`create_time`</span> <span class="keyword">desc</span> <span class="keyword">where</span> <span class="string">`id`</span> &gt; max_id <span class="keyword">limit</span> <span class="number">450</span>, <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>当数据库，采用分库分表，或者中间件时的分页操作，较为复杂，需要根据具体情况确定，本次不做陈述。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/03/20/Vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/20/Vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/" class="post-title-link" itemprop="url">Vim实用技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-20 10:06:09" itemprop="dateCreated datePublished" datetime="2017-03-20T10:06:09+08:00">2017-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-04-21 01:47:29" itemprop="dateModified" datetime="2017-04-21T01:47:29+08:00">2017-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Vim/" itemprop="url" rel="index"><span itemprop="name">Vim</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2><span id="介绍">介绍</span></h2><p><a href="https://keepalive555.github.io/2017/03/20/Vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/"><em>转载说明：本文章为作者原创，转载请标注原文地址</em></a></p>
<p>本人是一个vim党，平时的开发工作都是在vim下完成的，但是…vim的官方手册就达2000多页，所以本人将平时遇到的一些比较有趣的插件与配置记录在配置文件中，一是方便他人借阅，分享一些实用的技巧，另一方面也是自我的慢慢积累。</p>
<h2><span id="实用技巧">实用技巧</span></h2><h3><span id="1显示代码中的tab字符">1.显示代码中的Tab字符</span></h3><blockquote>
<p>Python2.7版本，代码缩进是不允许空格与制表符Tab混合使用的,否则会抛出IndentationError异常，这困扰过很多初学者，明明看着缩进都对，但是就是报错。</p>
</blockquote>
<ul>
<li>使用正则表达式替换</li>
<li>开启list选项，查看Tab字符与空格，:set list。</li>
</ul>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">lcs</span>=<span class="keyword">ta</span><span class="variable">b:</span>&gt;-,trai<span class="variable">l:</span>-</span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;C-l&gt;</span> :<span class="keyword">let</span> &amp;<span class="keyword">list</span>=&amp;<span class="keyword">list</span>==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span><span class="symbol">&lt;CR&gt;</span> <span class="comment">&quot;也可通过:set list显示</span></span><br></pre></td></tr></table></figure>

<h3><span id="2在代码中插入表达式值">2.在代码中插入表达式值</span></h3><blockquote>
<p>在开发工作中，经常需要输入一些常量值，因为数值比较大，不太容易计算的原因，很多同学直接输入了常量表达式。比如，存在时间戳t = int(time.time())，现在需要获取该时间戳24小时前的时间戳，可以这样写：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_t = int(time.time()) - <span class="number">24</span> * <span class="number">3600</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于Python这种解释性语言来说，这种开销就落到了运行时，所以在vim中插入表达式值这个技巧显得比较实用。<br>在插入模式下（注意是插入模式），按下<c-r>，然后键入=，=后面输入需要计算的表达式，摁下Enter便可以计算出该表达式的值。</c-r></p>
</blockquote>
<h2><span id="3未配置插件注释代码块">3.未配置插件，注释代码块</span></h2><blockquote>
<p>有时候需要在服务器上修改一些配置，或者脚本，而服务器的vim未配置，没有代码注释插件，该怎么达到目的呢？这时，可以按下<c-v>进入列选择模式，选中需要注释代码的前几列，可通过o或O调整选择块的范围，然后按下I，输入注释符，Python中为’#’，然后按下<esc>，便可大功告成（注意：按下A则在块后面添加）。</esc></c-v></p>
</blockquote>
<h2><span id="4快速关闭文件">4.快速关闭文件</span></h2><blockquote>
<p>大多数同学退出vim，都是在命令行下输入，:wq，退出，因为键位的缘故，个人感觉这样不是很方便，好在vim提供了更加便捷的方式。<br>关闭文件时，只需在普通模式下，输入ZZ，（即左侧shift+z，z按下两次），效果等同于:x命令，文件内容有改动，保存修改并退出，更改文件修改时间，如果文件未有改动则退出，不更改文件修改时间。</p>
</blockquote>
<blockquote>
<p>想要丢弃对文件的更改，大多数同学都是用，:q!，强制退出的。在vim中也可以在普通模式下输入ZQ，强制退出。</p>
</blockquote>
<h2><span id="5强制保存文件">5.强制保存文件</span></h2><blockquote>
<p>注意：此用法需要当前用户，在sudoer文件中授权。</p>
</blockquote>
<blockquote>
<p>在工作中经常遇到，root用户的vim未进行任何配置，而用普通用户去编辑的时候，保存却没有权限的尴尬。下面的vim命令可以，调用sudo进行修改保存，非常实用。</p>
</blockquote>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">w</span> !sudo tee %</span><br></pre></td></tr></table></figure>

<h2><span id="6快速选择代码段落">6.快速选择代码段落</span></h2><blockquote>
<p>常见选择方式：v - 选择字符，V - 行选择，<c-v> - 列选择。</c-v></p>
</blockquote>
<blockquote>
<p>大多数同学，进行多行代码选择时会用V开启行选择，然后通过j，k，o选择，代码块，或者是g跳转等，这样子虽然速度不慢，但是还是不够优雅。</p>
</blockquote>
<blockquote>
<p>vim中有个段落的概念（paragraphs），大家可以通过:tab help paragraphs，查看paragraphs的描述，或者该<a target="_blank" rel="noopener" href="http://blog.carbonfive.com/2011/10/17/vim-text-objects-the-definitive-guide/">博客</a><br>在开发工作中，我习惯将不同小功能，用空格划分为不同段落（Python开发中，这也是Pep8建议的），然后用段落移动命令，在段落间移动，用vip命令选择整个段落，很方便。</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>]]</td>
<td>foo</td>
</tr>
<tr>
<td>[[</td>
<td>bar</td>
</tr>
<tr>
<td>)</td>
<td>向前移动一条一语句（forward）</td>
</tr>
<tr>
<td>(</td>
<td>向后移动一条语句（backward）</td>
</tr>
<tr>
<td>{</td>
<td>向前移动至下一段落</td>
</tr>
<tr>
<td>}</td>
<td>向后移动至下一段落</td>
</tr>
<tr>
<td>vap</td>
<td>选择一个段落</td>
</tr>
<tr>
<td>vip</td>
<td>选择一个段落</td>
</tr>
</tbody></table>
<h2><span id="7设置vim分词">7.设置vim分词</span></h2><blockquote>
<p>在vim中，用w,b,e,ge,等可以在单词之前移动，这种移动方式，大大方便了我们的编程，但是也有一些不尽如人意的地方，比如，下面的函数foo，有a，b，c三个参数，想要把光标从a移动至b，则需要输入2w，（vim将逗号，作为一个单词），这样子不是很方便（用习惯的同学除外），vim有个iskeyword选项，定义了“单词”的组成字符，可以将“，”，“.”，做为单词的一部分，下次移动的时候直接按下w便可从参数a，移动至参数b。（个人习惯，不喜勿喷^_^）</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">a, b, c</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">	</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span>(<span class="params">object</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">d = Demo()</span><br><span class="line">d.__name__</span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">set</span> iskeyword+=\,</span><br><span class="line">:<span class="keyword">set</span> iskeyword+=\.</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">set</span> iskeyword+=\,\.</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/03/19/Shell%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/19/Shell%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/" class="post-title-link" itemprop="url">Shell实用技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-19 23:55:16" itemprop="dateCreated datePublished" datetime="2017-03-19T23:55:16+08:00">2017-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2017-04-23 00:08:53" itemprop="dateModified" datetime="2017-04-23T00:08:53+08:00">2017-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Shell/" itemprop="url" rel="index"><span itemprop="name">Shell</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://keepalive555.github.io/2017/03/19/Shell%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/"><em>转载说明：本文章为作者原创，转载请标注原文地址</em></a></p>
<h3><span id="1获取当前shell脚本文件所在目录">1.获取当前Shell脚本文件所在目录</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PREFIX=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br></pre></td></tr></table></figure>

<h3><span id="2ssh开启密钥登录">2.SSH开启密钥登录</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@host <span class="string">&#x27;mkdir -p .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys&#x27;</span> &lt; ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>

<h3><span id="3ssh端口转发">3.SSH端口转发</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup  /usr/bin/ssh -N -L 0.0.0.0:8000:10.10.10.10:12000 sa.demo.com &amp;</span><br></pre></td></tr></table></figure>

<h3><span id="4ios证书转换">4.iOS证书转换</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="keyword">in</span> demo.p12 -out demo.pem -nodes</span><br></pre></td></tr></table></figure>

<h3><span id="5统计代码行数">5.统计代码行数</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls *.py|xargs -n 1 wc -l|awk <span class="string">&#x27;BEGIN&#123;total=0&#125;&#123;$total+=$1&#125;END&#123;print &quot;total lines:\t&quot;$total&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://keepalive555.github.io/2017/01/05/Kafka%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lan Wei, Wang">
      <meta itemprop="description" content="技术博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶居">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/05/Kafka%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Kafka常见操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-05 00:35:26" itemprop="dateCreated datePublished" datetime="2017-01-05T00:35:26+08:00">2017-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-01-05 00:44:52" itemprop="dateModified" datetime="2018-01-05T00:44:52+08:00">2018-01-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2><span id="kafka常见操作命令行集锦"><code>Kafka</code>常见操作命令行集锦</span></h2><p><strong><em>导出变量定义：</em></strong> <code>$ZK_HOSTS</code>定义在<code>~/.bashrc</code>中的导出变量，为<code>Zookeeper</code>集群地址</p>
<blockquote>
<p>查看Kafka Cluster中的topic</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-topics.sh --list --zookeeper <span class="variable">$ZK_HOSTS</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看Kafka某个topic的信息</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-topics.sh --describe --topic benchmark --zookeeper <span class="variable">$ZK_HOSTS</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建一个1个partition的topic readbench</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-topics.sh --create --topic readbench --partitions 1 --replication-factor 1 --zookeeper <span class="variable">$ZK_HOSTS</span>```</span><br><span class="line"></span><br><span class="line">&gt; 新建一个1分区，复制因子为1的topic</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">./bin/kafka-topics.sh --create --topic name --partitions 1 --replication-factor 1 --zookeeper <span class="variable">$ZK_HOSTS</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建一个5分区，复制因子为1的topic</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-topics.sh --create --topic name --partitions 5 --replication-factor 1 --zookeeper <span class="variable">$ZK_HOSTS</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>以group_name为消费组消费名称为name的topic中的数据</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-console-consumer.sh --topic name --partition 0 --consumer-property group.id=group_name --from-beginning --bootstrap-server 10.95.134.86:9092,10.95.134.86:9093,10.95.134.86:9094</span><br></pre></td></tr></table></figure>

<blockquote>
<p>往topic name中生产数据</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh --broker-list 10.95.134.86:9092,10.95.134.86:9093,10.95.134.86:9094 --sync --topic name</span><br></pre></td></tr></table></figure>

<blockquote>
<p>物理删除kafka中的一个topic（kafka默认是逻辑删除）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;kafka-topics.sh --delete --topic name --zookeeper $ZK_HOSTS</span><br></pre></td></tr></table></figure>

<ul>
<li>删除掉<code>Zookeeper</code>集群中<code>name</code>标识的<code>topic</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/zkCli.sh rmr /brokers/topics/name</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Kafka</code>中为topic增加partition（不能够删除partition，仅支持增加）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-topics.sh --alter --topic name --zookeeper <span class="variable">$ZK_HOSTS</span> --partitions 3</span><br></pre></td></tr></table></figure>

<blockquote>
<p> Kafka中为topic更新配置参数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-topics.sh --alter --topic readbench --zookeeper <span class="variable">$ZK_HOSTS</span> --config cleanup.policy=delete</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Kafka集群中添加新的broker时，需要将一些topic的存储压力分散到新的broker上去，这时需要kafka reassign工具，分三步操作</p>
</blockquote>
<ul>
<li>1、指定待迁移的topic，以json格式存放在topic-to-move.json文件中。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; topics-to-move.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;topics&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;name1&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;name2&quot;</span>&#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: 1</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ul>
<li>2、生成移动脚本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-reassign-partitions.sh --zookeeper <span class="variable">$ZK_HOSTS</span> --topics-to-move-json-file topic-to-move.json --broker-list <span class="string">&quot;1,2&quot;</span> --generate</span><br></pre></td></tr></table></figure>

<p>将输出信息中的Proposed partition reassignment configuration一栏下的json字符串保存为reassign.json文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;readbench&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[3]&#125;]&#125;&#x27;</span> &gt;&gt; reassign.json</span><br></pre></td></tr></table></figure>

<ul>
<li>3、执行迁移脚本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-reassign-partitions.sh --zookeeper <span class="variable">$ZK_HOSTS</span> --reassignment-json-file reassign.json --execute</span><br></pre></td></tr></table></figure>

<ul>
<li>4、查看迁移进度</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/kafka-reassign-partitions.sh --zookeeper <span class="variable">$ZK_HOSTS</span> --reassignment-json-file reassign.json --verify</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lan Wei, Wang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Lan Wei, Wang</p>
  <div class="site-description" itemprop="description">技术博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/keepalive555" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;keepalive555" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:the.matrix.vvv@gmail.com" title="E-Mail → mailto:the.matrix.vvv@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lan Wei, Wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
